Long version of the interview with Najda Villefranque <mailto:najda.villefranque@meteo.fr>`_ (CNRM)
******************************************************************************************************

.. image:: photo_nv.jpg
  :width: 250

Najda, you've developed a 3D radiation simulator that can be applied to 3D fields from Meso-NH simulations. Could you summarize what this software does?
  The `htrdr <https://www.meso-star.com/projects/htrdr/htrdr.html>`_ software is a Monte Carlo-based code that simulates the trajectory of a large number of photons to solve atmospheric radiative transfer. It takes as input a 3D description of the atmosphere, typically outputs from Meso-NH simulations, as well as a description of surfaces (for example of a city as `here <https://web.lmd.jussieu.fr/~nvillefranque/pages/teapot_city>`_ but we can obviously also prescribe a flat surface). Photons interact with hydrometeors, aerosols, gases and surfaces through absorption/emission and scattering/reflection phenomena. The distribution of photons on virtual sensors positioned in the scene by the user gives an estimate of the intensity of radiation on these sensors.

What applications do you recommend using htrdr for?
  htrdr is a reference calculation program, so I recommend using it whenever there is a need for precise knowledge of a radiative quantity, whether solar (SW) or thermal (LW), in map form or horizontally integrated. This can be used, for example, to estimate the radiative effect of simulated clouds or aerosols, to study how they impact radiation according to their properties, or to evaluate and improve the parameterizations of large-scale models that don't see the full detail of the field and make approximations to the modeling of radiative transfer. Reference radiative calculations can also be used as a target when calibrating parameterizations in large-scale models for idealized cases, for which no observations are available. On this “reference” aspect, we could say that htrdr is to radiation what Meso-NH is to atmospheric dynamics! 

  htrdr can also be used to produce computer-generated images. The same simulation techniques are used by Disney to produce their films, although they are behind us as they don't yet use Meso-NH to simulate realistic clouds (laughs). These simulations can be used to visualize a 3D field from Meso-NH in the form of a photograph, or a time sequence in the form of a film, or to synthesize satellite-type images, useful for designing or evaluating inversion algorithms.

Why is it better to use htrdr than other equivalent programs? 
  The advantages of Monte Carlo methods in general are their accuracy (taking detailed processes into account, absence of bias), their flexibility (particularly in terms of spatial and spectral integration domains) and their theoretical insensitivity to the complexity of the virtual scenes in which photons propagate. Among specialists in the field, we often say that if we can solve a Monte Carlo problem in a cube, then we can solve it in a complex geometry (such as a city or a stadium). However, this theoretical insensitivity is rarely verified in practice, for computational reasons: data management (much more information is needed to describe a city than a cube) and processing of this data by intersection algorithms between the photon and surfaces (we need to find the point where the photon touches the surface, and this takes all the longer the more massive the data describing this surface). However, the computer graphics research community has produced tools that have made this insensitivity to scene complexity effective. Unlike other Monte Carlo codes in the atmospheric sciences, htrdr uses these tools and extends them to volume data |villefranque_etal|. As a result, the calculation time, while much longer than for an approximate “two-flow” calculation, does not depend on the amount of data to be ingested; a radiative calculation taking as input a Meso-NH output at 5 m resolution over a detailed relief will take no longer than for an output at 500 m over flat ground, at a fixed domain size. Another advantage of htrdr is that it is a living piece of software, undergoing continuous development within our community and also used and enriched in other communities, such as planetology.

What recommendations would you make to users?
  I'd recommend that they don't hesitate to contact me (or Robert Schoetter, who's also an htrdr expert!) if they want to get to grips with the software. There is `documentation <https://www.meso-star.com/projects/htrdr/man/man1/htrdr-atmosphere.1.html>`_ and `training material <https://mattermost.lmd.ipsl.fr/g3t-rayonnement/channels/htrdr>`_ available online for self-starting, but in my opinion it's best to discuss things in advance to make sure the software is right for the job. I can then help you choose configurations/options, guide you through inputs/outputs etc. It's also simply an opportunity to talk about radiation physics, even if the scientific question motivating the simulation is not directly related to radiative transfer, for example, for visualization purposes. Don't hesitate, because in real life, radiation is a lot more fun than you might think (laughs)!

What are the limitations?
  Compared with other, less precise methods, calculation time can be a limiting factor in the presence of highly scattering clouds. Even if for Meso-NH users who are used to running large simulations this is probably not technically limiting, it's good to be aware that it does consume a fair amount of energy. In a first phase of tuning, consider that you can run less power-hungry simulations by simulating a small number of photons - the estimate will be noisy (due to statistical uncertainty) but will give a first idea of the result of the simulation that has been launched - the equivalent of launching a first Meso-NH simulation on a small domain or at degraded resolution to make sure that the model is well tuned before launching a Giga-LES! For example, the diffusion phase function of hydrometeors and aerosols is an approximation of what Mie's theory predicts. This is by no means unsurpassable, but we will have to invest time in research and development to overcome this approximation, if necessary. Another example: to date, virtual sensors are defined as flat surfaces, so we can't estimate the integrated radiative flux on the surface of a mountain, for example. Similarly, there are proposals to include this functionality (already implemented in htrdr-urban by Robert), so it's “just a matter” of introducing it in the standard version of the software, when the need arises. In short, htrdr is a powerful tool, which can already be very useful, which obviously can't do everything, and in which new functions can be developed to meet new needs. Finally, I'd like to point out that, to date, htrdr is essentially a diagnostic tool, to be used offline on the output of simulations carried out elsewhere, with or without radiation. One of the perspectives of my research is to couple htrdr to Meso-NH to be able to make atmospheric simulations including a 3D resolution of radiation.


.. |villefranque_etal| raw:: html

   <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2018MS001602" target="_blank">(Villefranque et al., 2019)</a>
